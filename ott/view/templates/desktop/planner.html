<%inherit file="/desktop/base.html"/>
<%namespace name="util"  file="/shared/util.mako"/>

<%
    alerts = None
%>

<%def name="title()">TriMet: ${_(u'Trip Planner')} - ${_(u'From')} ${plan['from']['name']} ${_(u'to')} ${plan['to']['name']}</%def>

<%def name="app_css()">
    <link rel="stylesheet" href="${util.url_domain()}/css/tripplanform.css" type="text/css" /><!-- for trip planner pages -->
</%def>
<%def name="meta_data()">
    <meta name="Keywords"    content="Triplanner, OTP, routeplanner, planner"/>
    <meta name="Description" content=""/>
</%def>
<%def name="side_bar()">
            <!-- begin #sidebar -->
            <aside id="aside" class="aside">
                <div id="icon" class="icon-tripplanner">
                <p class="lead">${_(u'The Trip Planner provides step-by-step directions including where to board, how much to pay and where to transfer.')}</p>
                    <h2>${_(u'Related')}</h2>  
                    <ul class="links">
                      <li><a href="http://ride.trimet.org?mapit=I" title="${_(u'Plan trip on interactive map (fast connection recommended)')}">${_(u'Try out the Interactive Map Trip Planner')}</a></li>
                      <li><a href="${util.url_domain()}/tripplanner/help.htm" tabindex="17" title="${_(u'TriMet: Trip Planner Help')}" onclick="openPopup(this,'TripPlannerHelp','toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbars=yes,resizable=yes,width=550,height=500,left=10,top=10'); return false;" target="TripPlannerHelp" onclick="_gaq.push(['_trackEvent', 'Trip Planner Ads', 'ClickTo', '/tripplanner/help.htm']);">${_(u'Trip Planner tips & help')}</a></li>
                    </ul>
                </div>
                <p class="feedback"><a href="/feedback.html?app=">${_(u'Having problems? Click here for technical support.')}</a></p>
                %if alerts:
                %for a in alerts:
                    pass
                %endfor
                %endif
            </aside>
            <!-- end #sidebar -->
</%def>
<%def name="itin_tab(itin_list, i, text)">
    %if len(itin_list) >= i: 
        %if itin_list[i-1]['selected']:
        <span>${text}</span>
        %else:
        <a href="${itin_list[i-1]['url']}" class="unselected">${text}</a>
        %endif
    %endif
</%def>

<%
    def get_mode_img(mode):
        ''' return 20x20px mode gif for leg list 
        '''
        #import pdb; pdb.set_trace()
        ret_val = ''
        path = util.planner_img_url()
        if mode == util.attr.BUS:
            ret_val = path + "/bus.gif"
        if mode == util.attr.WALK:
            ret_val =  path + "/walk.gif"
        if mode == util.attr.TRAIN:
            ret_val = path + "/rail.gif"
        return ret_val


    def render_leg(leg):
        ''' call render stuff above...
        '''
        if leg['mode'] == util.attr.BUS:
            return render_transit_leg(leg)
        elif leg['mode'] == util.attr.WALK:
            return render_walk_leg(leg)
        return ''
%>

<%def name="render_transit_leg(leg)">
                <h3>
                    <img src="${get_mode_img(leg['mode'])}" alt="" border="0" class="icon" />
                    <b>
                        <a href="sched.pl?lang=t&start=05:12+pm&line=90&acode1=PO&x1=45.587579&y1=-122.593100&date=02/26/13&stopID=10579&loc1=Portland%20Int'l%20Airport%20MAX%20Station" title = "Show schedule for Portland Int\'l Airport MAX Station">5:12pm</a>
                    </b>
                    Board <a href="/schedules/r090.htm" title = "Show map and schedules for this route.">MAX  Red Line to City Center & Beaverton TC</a>
                </h3>
                <h3>
                    <b>
                        <a href="sched.pl?lang=t&start=05:52 PM&line=90&acode1=PO&x1=45.518699&y1=-122.677402&date=02/26/13&stopID=8382&loc1=Mall%2FSW%205th%20Ave%20MAX%20Station" title = "Show schedule for Mall/SW 5th Ave MAX Station">5:52pm</a>
                    </b>
                    Get off at <a href="stop_info.pl?lang=t&Id=7115&acode1=PO&x1=45.518699&y1=-122.677402&date=02/26/13" title = "Click for more information about this stop">Mall/SW 5th Ave MAX Station</a>
                </h3>
                <span class="stopid">Stop ID&nbsp;8382</span>
</%def>
<%def name="render_walk_leg(leg)">
                <h3>
                    <img src="${get_mode_img(leg['mode'])}" alt="" border="0" class="icon" />
                    Go to <a href="stop_info.pl?lang=t&Id=15951&acode1=PO&x1=45.518930&y1=-122.677573&date=02/26/13" title = "Click for more information about this stop">SW 5th &amp; Morrison</a>
                </h3>
                <span class="stopid">Stop ID&nbsp;7625</span>
</%def>


<%def name="planner_selected()">class="selected"</%def>

<p class="mobile"><a href="${util.url_domain()}/mobile/stop/locationID=${id}"><span>${_(u'Mobile')}</span></a></p>


<div class="planner-form">
    <div class="planner-form-top">
        <div class="planner-icon">
            <h1>${_(u'Your Trip on TriMet')}</h1>
            <div class="tagline">
                <div class="hide">
                    <form>
                        <input name="print" type="button" value="${_(u'Print')}" title="${_(u'Print this page')}" onClick="javascript:window.print();_gaq.push(['_trackEvent', 'TripPlanner', 'PrintClickTo', 'Itinerary print top']);" class="noprint" />
                    </form>
                </div>
            </div>
        </div>
        <div class="planner-header">
            <h2>${_(u'From')} ${plan['from']['name']} ${_(u'to')} ${plan['to']['name']}</h2>
        </div>
        %if len(plan['itineraries']) > 1:
        <div class="tabs">
            <p class="heading">
                ${itin_tab(plan['itineraries'], 1, _(u'Option 1: Your best bet'))}
                ${itin_tab(plan['itineraries'], 2, _(u'Option 2'))}
                ${itin_tab(plan['itineraries'], 3, _(u'Option 3'))}
            </p>
        </div>
        %endif


        <%
        ''' this is the variable assignment section of the page
        '''

        # find target itinerary 
        itinerary = plan['itineraries'][0]
        for itin in plan['itineraries']:
            if itin['selected']:
                itinerary = itin
                break

        # misc strings
        # TODO: we should put all of these strings in the .json file
        #       that way, we can share across ALL APPs, ala desktop, mobile, map, etc...
        #       note that we also need a legacy planner web service, so...
        # 
        depart_arrive = _(u'Depart after') 
        time = itinerary['date_info']['start_time']
        if plan['arrive_by']:
            depart_arrive = _(u'Arrive by')
            time = itinerary['date_info']['end_time']

        optimize = _(u'Quickest trip')
        if plan['optimize'] == 'SAFE':
            optimize = _(u'Safest trip')
        elif plan['optimize'] == 'TRANSFERS':
            optimize = _(u'Fewest transfers')

        %>
        <div id="itinerary">
            <table width="100%" border="0" cellspacing="5" cellpadding="0">
            <tr>
                <td width="15%"><strong>${_(u'When')}</strong></td> <td>${depart_arrive} ${time} ${itinerary['date_info']['pretty_date']}</td>
            </tr>
            <tr>
                <td><strong>${_(u'Preferences')}</strong></td><td>${optimize} ${_(u'with a maximum walk of')} 1 mile <a href="planner_form.html?${plan['params']}" title = "${_(u'Try different options')}" onclick="_gaq.push(['_trackEvent', 'TripPlanner', 'ClickTo', 'Itinerary edit top']);">${_(u'Edit')}</a></td>
            </tr>
            <tr>
                <td><strong>${_(u'Time')}</strong></td><td>${itinerary['date_info']['trip_time_text']}</td>
            </tr>
            <tr>
                <td>&nbsp;</td><td>${_(u'riding on transit')} ${_(u'from')} ${itinerary['date_info']['start_transit']} ${_(u'to')} ${itinerary['date_info']['end_transit']}</td>
            </tr>
            <tr>
                <td><strong>${_(u'Transfers')}</strong></td><td>${itinerary['transfers']} -- TODO -- singluar / plural / None</td>
            </tr> 
            <tr>
                <td><strong>${_(u'Fare')}</strong></td><td>${_(u'Adult')}: ${itinerary['fare']['adult']}, ${_(u'Youth')}: ${itinerary['fare']['youth']}, ${_(u'Honored Citizen')}: ${itinerary['fare']['honored']}</td>
            </tr>
            </table>
        </div>

        <ol id="tripsteps">
            <li class="first">
                <h3>
                    <img src="${util.url_domain()}/v3/images/tripplanner/start.gif" alt="" border="0" class="icon" /> 
                    ${_(u'Start at')} 
                    <a href="${plan['from']['map_img']}">${plan['from']['name']}</a>
                </h3>
                %if plan['from']['stop']:
                <h3>
                    <a href="${plan['from']['stop']['info']}" title = "${_(u'Click for more information about this stop')}">${plan['from']['stop']['name']}</a>
                </h3>
                <span class="stopid">${_(u'Stop ID')}&nbsp;${plan['from']['stop']['id']}</span>
                %endif
            </li>
            %for leg in itinerary['legs']:
            <li>
                ${render_leg(leg)}
            </li>
            %endfor

            <li class="last">
                <h3>
                    <img src="${util.url_domain()}/v3/images/tripplanner/end.gif" alt="" border="0" class="icon" /> 
                    ${_(u'End at')} 
                    <a href="${plan['to']['map_img']}">${plan['to']['name']}</a>
                </h3>
                %if plan['to']['stop']:
                <h3>
                    <a href="${plan['to']['stop']['info']}" title = "${_(u'Click for more information about this stop')}">${plan['to']['stop']['name']}</a>
                </h3>
                <span class="stopid">${_(u'Stop ID')}&nbsp;${plan['to']['stop']['id']}</span>
                %endif
            </li>
        </ol>

        <p id="buttons" class="hide">
            <span class="button-tripplanner"><a href="planner_form.html#TODO URL PARAMS" title="${_(u'Plan return trip')}"      onclick="_gaq.push(['_trackEvent', 'TripPlanner', 'ClickTo', 'Itinerary reverse']);">${_(u'Reverse')}</a></span>
            <span class="button-tripplanner"><a href="planner_form.html#TODO URL PARAMS" title="${_(u'Try different options')}" onclick="_gaq.push(['_trackEvent', 'TripPlanner', 'ClickTo', 'Itinerary edit']);">${_(u'Edit')}</a></span> 
            <span class="button-tripplanner"><a href="#" title="${_(u'Print this page')}"       onclick="javascript:window.print(); _gaq.push(['_trackEvent', 'TripPlanner', 'PrintClickTo', 'Itinerary print']);">${_(u'Print')}</a></span>
        </p>
        <p class="help"><a href="${util.url_domain()}/tripplanner/trip-help.htm" onclick="_gaq.push(['_trackEvent', 'Trip Planner Ads', 'ClickTo', '/tripplanner/trip-help.htm']);">${_(u'Help')}</a></p>
    </div>
    <div class="planner-form-bottom"></div>
</div>

<div class="disclaimer">
    <p class="disclaimer-feedback">
        <strong>${_(u'Tell us about your trip')}</strong>
        <br/>
        ${_(u'Visit')} <a href="${util.url_domain()}/contact/" onclick="_gaq.push(['_trackEvent', 'Trip Planner Ads','ClickTo', '/contact/']);">trimet.org/contact</a> ${_(u'or call')} 503-238-RIDE (7433), ${_(u'option 5')}.
    </p>
    <p>${_(u'Times shown are estimates based on schedules and can be affected by traffic, road conditions, detours and other factors. Before you go, check')}
        <a href="${util.url_domain()}/transittracker/about.htm" onclick="_gaq.push(['_trackEvent', 'Trip Planner Ads','ClickTo', '/transittracker/about.htm']);">TransitTracker</a>&trade; 
        ${_(u'for real-time arrival information and any Service Alerts that may affect your trip')}: ${_(u'Call')} 503-238-RIDE (7433), ${_(u'visit')} m.trimet.org, ${_(u'or text your Stop ID to')} 27299.
    </p>
</div>
